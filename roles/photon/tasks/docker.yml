#
# Copyright 2015 VMware, Inc.  All rights reserved.
# SPDX-License-Identifier: Apache-2.0 OR GPL-3.0-only
#
---
- name: Install the docker package
  tdnf:
    name: docker
    state: latest

- name: Assure docker group exists
  group:
    name: docker
    gid: "{{ docker_gid }}"
    state: present

- name: Assure Docker running and started at boot
  service:
    name: docker
    state: started
    enabled: yes

- name: Add docker Group spec in Docker unit file
  ini_file:
    dest: /usr/lib/systemd/system/docker.service
    section: Service
    option: Group
    value: docker
    backup: yes
  notify:
    - reload unit files
    - restart docker

- name: Install docker-py
  pip:
    name: docker-py
    state: present

- include: registry.yml
  when: docker_insecure_registries|length > 0

#
# configure docker deamon json file
#
- name: configure docker daemon.json
  template:
    src: daemon.json.j2
    dest: /etc/docker/daemon.json
    mode: 0400
    owner: root
    group: root
  notify: restart docker
